<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>packages/paperclip.js/lib/parser/xml/index.js - Mojo.js Docs</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="Mojo.js Docs"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.7.84</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/Animator.html">Animator</a></li>
            
                <li><a href="../classes/Application.html">Application</a></li>
            
                <li><a href="../classes/BaseView.html">BaseView</a></li>
            
                <li><a href="../classes/ListView.html">ListView</a></li>
            
                <li><a href="../classes/Mojo.html">Mojo</a></li>
            
                <li><a href="../classes/RegisteredClasses.html">RegisteredClasses</a></li>
            
                <li><a href="../classes/StateView.html">StateView</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/mojo.html">mojo</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: packages/paperclip.js/lib/parser/xml/index.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
var BaseParser = require(&quot;../base/parser&quot;),
ScriptParser   = require(&quot;../script&quot;),
XMLTokenizer   = require(&quot;./tokenizer&quot;),
TokenCodes     = XMLTokenizer.codes;

var NodeExpression   = require(&quot;./ast/node&quot;),
AttributeExpression  = require(&quot;./ast/attribute&quot;),
AttributesExpression = require(&quot;./ast/attributes&quot;),
ChildNodesExpression = require(&quot;./ast/childNodes&quot;),
RootExpression       = require(&quot;./ast/root&quot;),
StringExpression     = require(&quot;./ast/string&quot;),
TextNodeExpression   = require(&quot;./ast/textNode&quot;),
BlockExpression      = require(&quot;./ast/block&quot;),
prune                = require(&quot;./prune&quot;);


function XMLParser () {
  BaseParser.call(this, new XMLTokenizer());
  this._scriptParser = new ScriptParser();
}

var groups = {
  SCRIPT: TokenCodes.SCRIPT | TokenCodes.BSCRIPT | TokenCodes.ESCRIPT
};


BaseParser.extend(XMLParser, {

  /**
   */

  _parse: function () {

    var expressions = [], child;

    this._t.next();

    while (this._t.current) {
      expressions.push(this._parseExpression());
    }

    var root = new RootExpression(this._trimTextNodes(expressions));

    if (true) {
      root = prune.combineTextBlocks(root); // rendering is a bit slower
    }

    return root;
  },

  /**
   */

  _parseExpression: function () {

    var ccode;

    if (!(ccode = this._t.currentCode)) return;

    // &lt;
    if (ccode === TokenCodes.LT) {
      return this._parseNodeExpression();

    // {{ script }} or {{#block}}{{/}}
    } else if (ccode &amp; groups.SCRIPT) {
      return this._parseScriptBlockExpression();

    // something like &lt;!HTML&gt;
    } else if (ccode === TokenCodes.SN) {
      return this._parseStringNodeExpression();

    // text
    } else {
      return this._parseTextNodeExpression();
    }
  },

  /**
   */

  _parseNodeExpression: function () {


    var nodeName = this._t.next()[1];

    this._t.next(); // eat name

    var attributes   = this._parseNodeAttributeExpressions();

    var etag         = this._t.currentCode,
    children;


    if (etag === TokenCodes.GT) {
      this._t.next(); // eat &gt;
      children = this._parseChildNodeExpressions();

      this._t.next(); // eat &lt;/

      // assert node name matches
      this._t.next(); // eat node name
      this._t.next(); // eat &gt;

    } else {
      children = new ChildNodesExpression([]);
      this._t.next(); // eat /&gt;
    }

    this._t.skipWhite();

    return new NodeExpression(nodeName, attributes, children);
  },

  /**
   */

  _parseNodeAttributeExpressions: function () {
    var attrExprs = [];

    this._skipWs();

    while (this._t.currentCode === TokenCodes.WORD) {
      attrExprs.push(this._parseNodeAttributeExpression());

      this._skipWs();
    }


    return new AttributesExpression(attrExprs);
  },

  /**
   */

  _skipWs: function () {
    while(this._t.currentCode === TokenCodes.WS) {
      this._t.next();
    }
  },

  /**
   */

  _parseNodeAttributeExpression: function () {
    var attrName = this._t.current[1];

    this._t.nextSkipWhite(); // eat name

    var values = [];

    if (this._t.current[0] === TokenCodes.EQ) {
      this._t.nextSkipWhite(); // eat = 
      values = this._parseAttributeValues();
    }


    return new AttributeExpression(attrName, values);
  },

  /**
   */

  _parseAttributeValues: function () {



    var quoteCode = this._t.currentCode,
    ccode;

    this._t.nextSkipWhite(); // eat quote

    var values = [], buffer = [];

    while ((ccode = this._t.currentCode) !== quoteCode &amp;&amp; ccode) {
      if (!(ccode &amp; groups.SCRIPT)) {
        buffer.push(this._t.current[1]);
        this._t.next();
      } else {
        if (buffer.length) {
          values.push(new StringExpression(buffer.join(&quot;&quot;)));
          buffer = [];
        }
        values.push(this._parseAttrScriptExpression()); 
      }
    }

    if(buffer.length) {
      values.push(new StringExpression(buffer.join(&quot;&quot;)));
    }

    this._t.next(); // eat quote

    return values;
  },

  /**
   */

  _parseAttrScriptExpression: function () {
    var script = this._t.current[1];
    this._t.next();

    var root = this._scriptParser.parse(script);

    if (root.expressions[0].name === &quot;value&quot;) {
      return root.expressions[0];
    }

    return root;
  },

  /**
   */

  _parseChildNodeExpressions: function () {

    var children = [], child;

    while (this._t.currentCode !== TokenCodes.LTSL &amp;&amp; (child = this._parseExpression())) {
      children.push(child);
    }

    return new ChildNodesExpression(this._trimTextNodes(children));
  },

  /**
   */

  _parseScriptBlockExpression: function () {

    var source = this._t.current[1];

    // if block, or end script, scripts must be defined. If something like {{/else}} , it needs to be else:true
    if ((this._t.currentCode &amp; (TokenCodes.ESCRIPT|TokenCodes.BSCRIPT)) &amp;&amp; !~source.indexOf(&quot;:&quot;)) {
      source += &quot;:true&quot;;
    }

    var script = this._scriptParser.parse(source),
    ccode      = this._t.current[0];

    this._t.next(); // eat script

    var expressions = [],
    childBlockExpression;

    if (ccode &amp; (TokenCodes.BSCRIPT | TokenCodes.ESCRIPT)) {
      while ((ccode = this._t.currentCode) !== TokenCodes.ESCRIPT &amp;&amp; ccode) {
        expressions.push(this._parseExpression());
      }
    }

    if (ccode === TokenCodes.ESCRIPT) {

      // make sure there&#x27;s a script
      if (this._t.current[1]) {
        childBlockExpression = new RootExpression([this._parseScriptBlockExpression()]);
      } else {
        this._t.next(); // no script - it&#x27;s a end block {{/}}. Eat it.
      }
    }

    return new BlockExpression(script, new RootExpression(this._trimTextNodes(expressions)), childBlockExpression);
  },

  /**
   */

  _trimTextNodes: function (expressions) {


    function _trim (exprs) {
      var expr, i;
      for (i = exprs.length; i--;) {
        expr = exprs[i];
        if (expr.type == &quot;textNode&quot; &amp;&amp; !/\S/.test(expr.value)) {
          exprs.splice(i, 1);
        } else {
          break;
        }
      }
      return exprs;
    }

    return _trim(_trim(expressions.reverse()).reverse());
  },

  /**
   */

  _parseStringNodeExpression: function () {
    var buffer = this._t.current[1];
    this._t.next(); // eat it.
    return new TextNodeExpression(buffer);
  },

   /**
    */

  _parseTextNodeExpression: function () {

    var ecode = TokenCodes.BSCRIPT | TokenCodes.SCRIPT | TokenCodes.ESCRIPT | TokenCodes.LT | TokenCodes.LTSL;

    var ccode, buffer = &quot;&quot;;

    while (!((ccode = this._t.currentCode) &amp; ecode) &amp;&amp; ccode) {
      buffer += this._t.current[1];
      this._t.next();
    }

    return new TextNodeExpression(buffer);
  }
});

module.exports = XMLParser;
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
